---
phase: 02-location-discovery
plan: 02
type: execute
---

<objective>
Build location selection UI components for city picker, area filter, and "near me" toggle.

Purpose: Enable users to easily set their location for deal discovery through intuitive UI.
Output: CityPicker, AreaFilter, LocationSelector, LocationDisplay components integrated with LocationContext.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@CLAUDE.md

**Depends on:** 02-01-PLAN.md (location types, expanded data, context provider)

**From Phase 1:**
@src/types/location.ts - City, LocationArea, LocationState types
@src/components/ui/button.tsx - Button component
@src/components/ui/card.tsx - Card component
@src/components/ui/modal.tsx - Modal component
@src/components/ui/input.tsx - Input component

**From 02-01:**
@src/lib/context/locationContext.tsx - useLocation hook, LocationProvider
@src/lib/mock-data - cities, getAreasForCity, etc.

**UI requirements:**
- City picker dropdown with search
- Area filter as secondary selection within city
- "Near me" toggle to auto-detect location
- Location display in header
- Glassmorphic styling per design system

**Component architecture:**
- CityPicker, AreaFilter → components/patterns/ (reusable compositions)
- LocationSelector → components/features/ (domain logic)
- LocationDisplay → components/layout/ (header integration)

**Type names (from Phase 1):**
- Use `LocationArea` (NOT `Area`)
- Use `City`
- Import from `@/types`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CityPicker and AreaFilter pattern components</name>
  <files>src/components/patterns/cityPicker.tsx, src/components/patterns/areaFilter.tsx</files>
  <action>
1. Create src/components/patterns/cityPicker.tsx:
   - Props: cities: City[], selectedCity: City | null, onSelect: (city: City) => void, placeholder?: string
   - Dropdown trigger shows selected city or placeholder
   - Search input filters cities by name, state, or stateCode
   - City list with checkmark for selected
   - Close on outside click
   - Focus search input when opened
   - Use glassmorphic styling: bg-glass-bg, backdrop-blur-md, border-glass-border
   - Icons: MapPin, MagnifyingGlass, CaretDown, Check from @phosphor-icons/react

2. Create src/components/patterns/areaFilter.tsx:
   - Props: areas: LocationArea[], selectedArea: LocationArea | null, onSelect: (area: LocationArea | null) => void, disabled?: boolean
   - Smaller pill/chip style button
   - "All areas" option to clear selection
   - Show area list when clicked
   - X button to clear when area selected
   - Return null if areas.length === 0
   - Icons: CaretDown, Check, X from @phosphor-icons/react
  </action>
  <verify>npm run build succeeds, components render without errors, TypeScript types correct</verify>
  <done>CityPicker with search and dropdown, AreaFilter with clear option, both using correct LocationArea type</done>
</task>

<task type="auto">
  <name>Task 2: Create LocationSelector and LocationDisplay components</name>
  <files>src/components/features/locationSelector.tsx, src/components/layout/locationDisplay.tsx, src/app/page.tsx</files>
  <action>
1. Create src/components/features/locationSelector.tsx:
   - Uses useLocation() hook from context
   - "Near me" button that calls detectLocation()
   - Shows loading spinner during detection (SpinnerGap icon)
   - Shows error message if permission denied (WarningCircle icon)
   - "or" divider between detect and manual
   - CityPicker for city selection
   - AreaFilter appears when city selected and areas exist
   - Props: showAreaFilter?: boolean, compact?: boolean, onLocationChange?: () => void
   - Icons: Crosshair (near me), SpinnerGap (loading), WarningCircle (error)

2. Create src/components/layout/locationDisplay.tsx:
   - Compact button showing current location (city, area)
   - Opens Modal with LocationSelector on click
   - Shows "Set location" if no city selected
   - Shows "Beverly Hills, Los Angeles" format if area selected
   - Shows "Austin, TX" format if only city selected
   - Uses Modal from @/components/ui/modal
   - Icons: MapPin, CaretDown

3. Update src/app/page.tsx to test location components:
   - Import LocationDisplay and LocationSelector
   - Add LocationDisplay to header area
   - Add Card with LocationSelector for testing
   - Show current location state for debugging
  </action>
  <verify>npm run build succeeds, LocationSelector renders with all controls, LocationDisplay shows in header</verify>
  <done>LocationSelector combines all location UI, LocationDisplay ready for header integration</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete location discovery UI with city picker, area filter, and near me detection</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000
    3. Verify header shows location button (initially "Austin, TX" or similar default)
    4. Click location in header - modal should open with:
       - "Near me" button (click to test browser geolocation prompt)
       - City picker dropdown with search (try searching "Los Angeles" or "New York")
       - Area filter appears when city is selected
    5. Select a city (e.g., Los Angeles)
    6. Select an area (e.g., Beverly Hills)
    7. Header should update to show "Beverly Hills, Los Angeles"
    8. Close modal, refresh page - location should persist
    9. Test "Near me" - should request permission and detect nearest city
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] CityPicker renders dropdown with search functionality
- [ ] AreaFilter renders when city is selected
- [ ] LocationSelector combines all elements with "near me" button
- [ ] LocationDisplay shows current location in compact format
- [ ] Modal opens for location change
- [ ] Location persists in localStorage across page refresh
- [ ] Browser geolocation permission is requested when "near me" clicked
- [ ] Nearest city is found when location detected
- [ ] Human verification approved
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- CityPicker with search, 6+ cities available
- AreaFilter shows areas for selected city
- "Near me" button triggers geolocation
- Location persists via localStorage
- Clean glassmorphic UI matching design system
</success_criteria>

<output>
After completion, create `.planning/phases/02-location-discovery/02-02-SUMMARY.md`
</output>
