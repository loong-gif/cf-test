---
phase: 04-consumer-auth
plan: 02
type: execute
---

<objective>
Create SignInForm component and AuthModal wrapper for unified auth UI.

Purpose: Complete the authentication UI with sign-in capability and modal presentation.
Output: SignInForm component, AuthModal component that switches between sign-up/sign-in.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/04-consumer-auth/04-01-SUMMARY.md

# Existing patterns:
@src/lib/context/authContext.tsx - Auth context (from 04-01)
@src/components/features/signUpForm.tsx - Sign-up form (from 04-01)
@src/components/ui/modal.tsx - Modal component
@src/components/ui/input.tsx - Input component
@src/components/ui/button.tsx - Button component

**Tech stack available:** AuthContext, Modal, Input, Button components
**Established patterns:** Form validation pattern from SignUpForm
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SignInForm component</name>
  <files>src/components/features/signInForm.tsx</files>
  <action>
Create 'use client' component for sign-in form:

1. Props interface:
   - onSuccess?: () => void
   - onSwitchToSignUp?: () => void
   - onForgotPassword?: () => void

2. Form state:
   - email, password
   - errors object
   - isSubmitting boolean

3. Validation on submit:
   - Email: required, valid format
   - Password: required

4. On submit:
   - Call useAuth().signIn(email, password)
   - Handle errors (user not found = show error)
   - On success: call onSuccess()

5. UI structure:
   - Input for email with error prop
   - Input for password (type="password") with error prop
   - "Forgot password?" link (calls onForgotPassword, shows toast "Check your email" for MVP)
   - Button "Sign In" with isLoading state
   - "Don't have an account? Sign up" link calling onSwitchToSignUp

Match SignUpForm styling for consistency.
  </action>
  <verify>npm run build passes. Component renders without errors.</verify>
  <done>SignInForm validates input, calls signIn on submit, shows errors, has switch links.</done>
</task>

<task type="auto">
  <name>Task 2: Create AuthModal component</name>
  <files>src/components/features/authModal.tsx</files>
  <action>
Create 'use client' component that wraps sign-up and sign-in in a modal:

1. Props interface:
   - isOpen: boolean
   - onClose: () => void
   - initialView?: 'signUp' | 'signIn' (default 'signUp')
   - onSuccess?: () => void

2. Local state:
   - currentView: 'signUp' | 'signIn'

3. useEffect to reset currentView when initialView changes or modal opens

4. Render Modal component with:
   - size="md"
   - No title (forms have their own headers)
   - Conditional content based on currentView:
     - 'signUp': SignUpForm with onSuccess and onSwitchToSignIn
     - 'signIn': SignInForm with onSuccess and onSwitchToSignUp

5. onSuccess handler:
   - Call props.onSuccess()
   - Call props.onClose()

6. Add header inside modal content (not Modal title):
   - "Create Account" for signUp
   - "Welcome Back" for signIn
   - Styled as text-xl font-semibold text-text-primary mb-6 text-center
  </action>
  <verify>npm run build passes. Modal opens, switches between forms, closes on success.</verify>
  <done>AuthModal renders sign-up or sign-in form, switches between them, calls onSuccess and closes.</done>
</task>

<task type="auto">
  <name>Task 3: Connect AuthModal to ClaimCTA</name>
  <files>src/components/features/claimCTA.tsx, src/app/deals/[id]/page.tsx</files>
  <action>
Update ClaimCTA to open AuthModal:

1. In claimCTA.tsx:
   - Add local state: isModalOpen, modalView ('signUp' | 'signIn')
   - Import AuthModal
   - onSignUp button: setModalView('signUp'), setIsModalOpen(true)
   - onSignIn link: setModalView('signIn'), setIsModalOpen(true)
   - Render AuthModal at bottom of component with isOpen, onClose, initialView

2. In page.tsx:
   - Remove onSignUp/onSignIn props from ClaimCTA (now handled internally)
   - ClaimCTA only needs dealId prop now

This makes ClaimCTA self-contained for auth flow.
  </action>
  <verify>Visit /deals/deal-1, click "Create Free Account", modal opens with sign-up form. Click "Already have an account?", switches to sign-in.</verify>
  <done>ClaimCTA opens AuthModal on button clicks, modal switches between forms correctly.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] SignInForm validates and calls signIn
- [ ] AuthModal switches between forms
- [ ] ClaimCTA opens modal on button clicks
</verification>

<success_criteria>
- SignInForm component with validation
- AuthModal wraps both forms with view switching
- ClaimCTA integrated with AuthModal
- Auth flow works end-to-end (UI only)
- Ready for 04-03 (email verification)
</success_criteria>

<output>
After completion, create `.planning/phases/04-consumer-auth/04-02-SUMMARY.md`
</output>
