---
phase: 05-consumer-dashboard
plan: 02
type: execute
---

<objective>
Implement saved deals / favorites functionality with context state and favorites page.

Purpose: Allow consumers to save deals for later and view them in a dedicated dashboard page.
Output: Save/unsave functionality on deal cards, favorites page at /dashboard/favorites.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-consumer-dashboard/05-01-SUMMARY.md

**Tech stack available:** AuthContext, DealCard, useAuth hook
**Established patterns:** Context state with localStorage persistence, Consumer type with savedDeals concept
**Key files:**
@src/lib/context/authContext.tsx
@src/components/features/dealCard.tsx
@src/types/consumer.ts

**Constraining decisions:**
- Phase 05-01: Dashboard layout with protected routes
- Consumer type already has favoriteCategories, but savedDeals is in ConsumerPreferences
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add savedDeals state and methods to AuthContext</name>
  <files>src/lib/context/authContext.tsx</files>
  <action>
Extend AuthContext to manage saved deals:

1. Add savedDeals array to AuthState (string[] of deal IDs)
2. Add to AuthContextValue:
   - `savedDeals: string[]`
   - `saveDeal: (dealId: string) => void`
   - `unsaveDeal: (dealId: string) => void`
   - `isDeallSaved: (dealId: string) => boolean`

3. Persist savedDeals to localStorage:
   - Key: 'costfinders_saved_deals'
   - Load on mount for authenticated users
   - Save on add/remove

4. Implementation:
   - saveDeal: Add dealId to array if not present
   - unsaveDeal: Remove dealId from array
   - isDealSaved: Check if dealId in array

Initialize with empty array. No need to tie to Consumer type - localStorage is sufficient for UI-only build.
  </action>
  <verify>TypeScript compiles, useAuth exposes savedDeals and methods</verify>
  <done>AuthContext provides savedDeals state with save/unsave/check methods, persisted to localStorage</done>
</task>

<task type="auto">
  <name>Task 2: Create SaveButton component for DealCard</name>
  <files>src/components/patterns/saveButton.tsx, src/components/features/dealCard.tsx</files>
  <action>
1. Create `src/components/patterns/saveButton.tsx`:
   - Props: dealId (string), size ('sm' | 'md'), className (optional)
   - Use useAuth to get savedDeals, saveDeal, unsaveDeal, isAuthenticated
   - Heart icon (Phosphor): outline if not saved, fill if saved
   - Click toggles saved state
   - If not authenticated, show tooltip hint "Sign in to save deals"
   - Animate on toggle (scale pulse)
   - Prevent event bubbling (stopPropagation for use inside links)

2. Modify `src/components/features/dealCard.tsx`:
   - Add SaveButton to top-right corner of card
   - Position absolute over image area
   - Use size="sm" variant
   - Only show for authenticated users OR show disabled state

Styling: Heart icon red when filled, muted when outline. Glassmorphic button background.
  </action>
  <verify>SaveButton appears on deal cards, toggles fill state on click</verify>
  <done>SaveButton component works, integrated into DealCard with proper positioning</done>
</task>

<task type="auto">
  <name>Task 3: Create favorites page at /dashboard/favorites</name>
  <files>src/app/dashboard/favorites/page.tsx</files>
  <action>
Create the saved deals / favorites page:

1. 'use client' for useAuth access
2. Get savedDeals from useAuth
3. Fetch deal data using getAnonymousDealById for each saved ID
4. Filter out any null results (deleted deals)
5. Display in responsive grid (same as deals page)
6. Use DealCard component for each deal

Empty state:
- Heart icon (large, muted)
- "No saved deals yet"
- "Browse deals and tap the heart icon to save for later"
- Link to /deals

Page title in layout: "Favorites"
Breadcrumb or back link to dashboard home

Use existing DealCard - it already has SaveButton from Task 2.
  </action>
  <verify>Navigate to /dashboard/favorites shows saved deals or empty state</verify>
  <done>Favorites page displays saved deals in grid, shows empty state when none saved</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Saved deals functionality with favorites page</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Sign in as existing user
    3. Go to /deals page
    4. Click heart icon on a deal card - should fill red
    5. Navigate to /dashboard/favorites - deal should appear
    6. Click heart again to unsave - should be removed
    7. Refresh page - saved deals should persist
    8. Sign out - favorites should be empty on sign in with different account
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] SaveButton toggles correctly on deal cards
- [ ] Saved deals persist across page refreshes
- [ ] Favorites page shows saved deals
- [ ] Empty state displays when no saved deals
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Save/unsave is intuitive and responsive
- Favorites page matches design system
</success_criteria>

<output>
After completion, create `.planning/phases/05-consumer-dashboard/05-02-SUMMARY.md`
</output>
