---
phase: 05-consumer-dashboard
plan: 05
type: execute
---

<objective>
Implement user profile editing and settings page with alert preferences.

Purpose: Allow consumers to manage their profile information and notification preferences.
Output: ProfileForm component, AlertPreferences component, /dashboard/settings page.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-consumer-dashboard/05-04-SUMMARY.md

**Tech stack available:** AuthContext with user state, Input/Button components, form patterns
**Established patterns:** Form validation, context state updates, toggle switches
**Key files:**
@src/lib/context/authContext.tsx
@src/types/consumer.ts
@src/components/features/signUpForm.tsx

**Constraining decisions:**
- Consumer has: firstName, lastName, email, phone, locationCity, locationState
- Consumer has: alertsEmail, alertsSms, favoriteCategories
- AuthContext manages user state
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add profile update methods to AuthContext</name>
  <files>src/lib/context/authContext.tsx</files>
  <action>
Extend AuthContext with profile management:

1. Add to AuthContextValue:
   - `updateProfile: (updates: Partial<Consumer>) => void`
   - `updateAlertPreferences: (alertsEmail: boolean, alertsSms: boolean) => void`

2. Implement updateProfile:
   - Merge updates with current user
   - Update state and persist to dynamicUsers
   - Fields allowed: firstName, lastName, phone, locationCity, locationState
   - NOT allowed to change: email (identity), verificationStatus (separate flow)

3. Implement updateAlertPreferences:
   - Update alertsEmail and alertsSms on user
   - Persist to dynamicUsers

4. Both methods should update updatedAt timestamp

Note: For UI-only build, changes persist in memory/localStorage. Backend would handle actual persistence.
  </action>
  <verify>TypeScript compiles, useAuth exposes updateProfile and updateAlertPreferences</verify>
  <done>AuthContext provides profile and alert preference update methods</done>
</task>

<task type="auto">
  <name>Task 2: Create ProfileForm and AlertPreferences components</name>
  <files>src/components/features/profileForm.tsx, src/components/features/alertPreferences.tsx</files>
  <action>
1. Create `src/components/features/profileForm.tsx`:
   - Form fields:
     - First Name (Input)
     - Last Name (Input)
     - Phone (Input, show verified badge if phoneVerifiedAt exists)
     - City (Input or select from available cities)
     - State (auto-filled based on city or manual)
   - Email shown as read-only with verified badge
   - Save button
   - On submit: call updateProfile
   - Success toast/message: "Profile updated"
   - Validation: phone format if provided

2. Create `src/components/features/alertPreferences.tsx`:
   - Two toggle switches:
     - "Email notifications" (alertsEmail)
     - "SMS notifications" (alertsSms) - only if phone verified
   - Description text under each toggle
   - Auto-save on toggle (no save button needed)
   - Show verification prompt if SMS toggle but phone not verified

Use existing Input, Button components. Toggle can be a styled checkbox or custom switch component.
  </action>
  <verify>ProfileForm saves changes, AlertPreferences toggles work</verify>
  <done>ProfileForm and AlertPreferences components handle user settings</done>
</task>

<task type="auto">
  <name>Task 3: Create settings page at /dashboard/settings</name>
  <files>src/app/dashboard/settings/page.tsx</files>
  <action>
Create the settings/profile page:

1. 'use client' for context access
2. Two sections with Card wrappers:

Section 1: "Profile"
- ProfileForm component
- Verification status display:
  - Email: verified badge or "Verify email" link
  - Phone: verified badge or "Add phone" / "Verify phone" link
- Link to re-verify opens appropriate modal (stretch: add to AuthModal)

Section 2: "Notifications"
- AlertPreferences component
- Explanation: "Control how CostFinders contacts you about deals and claims"

Section 3: "Account" (simple)
- Sign out button
- "Delete account" link (shows: "Contact support to delete your account")

Page layout:
- Max-width container for readability
- Sections stacked vertically
- Clear visual separation between sections

Page title: "Settings"
  </action>
  <verify>Navigate to /dashboard/settings shows profile form and alert preferences</verify>
  <done>Settings page displays profile editing and notification preferences</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete profile and settings page</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Sign in as any user
    3. Navigate to: http://localhost:3000/dashboard/settings
    4. Verify: Profile form displays with current user data
    5. Edit first name and save - verify change persists
    6. Toggle email notifications - verify state updates
    7. If phone not verified, SMS toggle should be disabled/show prompt
    8. Sign out button works
    9. Navigate away and back - changes should persist
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Profile form saves and displays user data
- [ ] Alert preference toggles work correctly
- [ ] Settings page layout is clean and organized
- [ ] Changes persist across navigation
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Settings page is intuitive and functional
- Phase 5 is complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-consumer-dashboard/05-05-SUMMARY.md`

Final summary should note:
- Phase 5: Consumer Dashboard complete
- Dashboard shell with navigation
- Favorites system with save/unsave
- Claim deal flow
- Claim status tracking
- Profile and settings management
</output>
