---
phase: 06-business-onboarding
plan: 02
type: execute
---

<objective>
Create claim existing business flow with ownership verification UI.

Purpose: Allow business owners to claim their pre-existing (scraped) business profile.
Output: Claim flow pages, verification form, business auth integration in app layout.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-business-onboarding/06-01-SUMMARY.md (if exists after 06-01)

**Prior patterns to follow:**
@src/lib/context/businessAuthContext.tsx - Business auth context (from 06-01)
@src/components/features/emailVerification.tsx - Verification UI pattern
@src/components/features/phoneVerification.tsx - Code entry pattern
@src/components/features/signUpForm.tsx - Form validation pattern

**Business data:**
@src/types/business.ts - Business type
@src/lib/mock-data/businesses.ts - Mock businesses

**Relevant decisions:**
- Phase 04: Mock verification accepts any 6 digits
- Phase 04: Two-view verification (check-email + manual code entry)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add BusinessAuthProvider to app layout</name>
  <files>src/app/layout.tsx</files>
  <action>
  Import and wrap app with BusinessAuthProvider:

  1. Import BusinessAuthProvider from '@/lib/context/businessAuthContext'

  2. Add BusinessAuthProvider inside LocationProvider, alongside AuthProvider:
     LocationProvider > AuthProvider + BusinessAuthProvider > children

  3. Order: Both auth providers are siblings, both inside LocationProvider

  This enables useBusinessAuth throughout the app for business-side features.
  </action>
  <verify>npm run build passes, no context errors</verify>
  <done>BusinessAuthProvider available app-wide</done>
</task>

<task type="auto">
  <name>Task 2: Create ClaimBusinessFlow component and claim page</name>
  <files>src/components/features/claimBusinessFlow.tsx, src/app/business/claim/[businessId]/page.tsx</files>
  <action>
  1. Create ClaimBusinessFlow component with multi-step flow:

  Step 1 - Business Confirmation:
     - Show business details (name, address, phone)
     - "Is this your business?" confirmation
     - Continue button

  Step 2 - Owner Sign Up/Sign In:
     - If not authenticated (useBusinessAuth), show sign-up/sign-in forms
     - Reuse input patterns from consumer forms
     - Email, password, first name, last name fields
     - On auth success, proceed to step 3

  Step 3 - Verification Request:
     - "We'll verify you own this business"
     - Options: "I have access to the business email" or "Call the business phone"
     - Mock: Show 6-digit code entry (accepts any 6 digits)
     - On verify, update claimStatus to 'pending' and linkBusiness

  Step 4 - Claim Submitted:
     - Success message: "Your claim is being reviewed"
     - "We'll notify you within 24-48 hours"
     - CTA: "Go to Business Dashboard" (navigates to /business/dashboard - built in Phase 7)

  2. Create claim page at src/app/business/claim/[businessId]/page.tsx:
     - Server component that fetches business by ID
     - Pass business to ClaimBusinessFlow client component
     - Handle not found with notFound()

  Props for ClaimBusinessFlow:
  - business: Business
  - onComplete: () => void

  Use: ArrowRight for continue, CheckCircle for success, Shield for verification
  </action>
  <verify>Navigate to /business/claim/biz-1, flow works through all steps</verify>
  <done>Complete claim flow from business confirmation through verification submission</done>
</task>

<task type="auto">
  <name>Task 3: Update business mock data with claim utilities</name>
  <files>src/lib/mock-data/businesses.ts, src/lib/mock-data/utils.ts</files>
  <action>
  Add utilities for claim flow:

  1. In businesses.ts:
     - Export getBusinessById(id: string): Business | undefined
     - Export searchBusinessesByName(query: string): Business[]
     - Export getUnclaimedBusinesses(): Business[]

  2. In utils.ts (or businesses.ts if simpler):
     - Add claimBusiness(businessId: string, ownerId: string) function
     - Updates business tier to 'free', sets claimedBy, claimedAt, isVerified
     - Uses dynamic array pattern (like dynamicUsers in authContext)

  3. Track claimed businesses in session with dynamicBusinesses array

  This enables the claim flow to update business state during the session.
  Avoid: Don't modify the original businesses array directly.
  </action>
  <verify>getBusinessById returns business, searchBusinessesByName filters correctly</verify>
  <done>Business query utilities and claim mutation ready</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] /business/claim/biz-1 shows Glow Aesthetics details
- [ ] Claim flow progresses through all 4 steps
- [ ] Mock verification accepts any 6 digits
- [ ] Business marked as claimed after flow completes
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Business owners can find and claim existing businesses
- Verification UI matches consumer verification patterns
- Claim status properly tracked in BusinessAuthContext
</success_criteria>

<output>
After completion, create `.planning/phases/06-business-onboarding/06-02-SUMMARY.md`
</output>
