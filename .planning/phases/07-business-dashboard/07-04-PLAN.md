---
phase: 07-business-dashboard
plan: 04
type: execute
---

<objective>
Create in-platform messaging system and performance analytics dashboard.

Purpose: Enable communication between businesses and leads, plus provide performance insights.
Output: Messaging thread UI integrated with lead detail, analytics dashboard with key metrics.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Prior plan context:
@.planning/phases/07-business-dashboard/07-03-SUMMARY.md

# Types:
@src/types/claim.ts
@src/types/deal.ts

**Tech stack available:** Claim, Deal types, lead management from 07-03
**Established patterns:** Glassmorphic cards, form inputs, responsive grids
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Message type and MessageThread component</name>
  <files>src/types/message.ts, src/types/index.ts, src/components/features/messaging/messageThread.tsx, src/lib/mock-data/messages.ts</files>
  <action>Create Message type in types/message.ts:
- id: string
- claimId: string
- senderId: string
- senderType: 'business' | 'consumer'
- content: string
- createdAt: string
- readAt?: string

Export from types/index.ts.

Create mock messages in messages.ts with getMessagesForClaim(claimId) and sendMessage(claimId, content, senderType) utilities. Seed 2-3 mock conversations.

Create MessageThread component:
- Message list with bubbles (business messages right-aligned blue, consumer left-aligned gray)
- Timestamp on each message
- Input field at bottom with send button (PaperPlaneRight icon)
- Auto-scroll to latest message
- Empty state: "Start the conversation"

Glassmorphic container, max-height with scroll for message area.</action>
  <verify>Component renders, mock messages display, send adds new message to list</verify>
  <done>MessageThread component displays conversation with send functionality</done>
</task>

<task type="auto">
  <name>Task 2: Integrate messaging into lead detail and create messages page</name>
  <files>src/components/features/leadManagement/leadDetail.tsx, src/app/business/dashboard/messages/page.tsx</files>
  <action>Update LeadDetail to include MessageThread component below the status section. Only show messaging if claim status is not 'pending' (must contact first).

Create /business/dashboard/messages page:
- List of all conversations (unique claims with messages)
- Show: Consumer identifier, Deal title, Last message preview, Unread count badge, Time
- Click navigates to /business/dashboard/leads/[claimId] (reuse detail page)
- Sort by most recent message
- Filter: All, Unread

Add getConversationsForBusiness(businessId) utility that aggregates claims with messages.</action>
  <verify>LeadDetail shows messaging, messages page lists conversations</verify>
  <done>Messaging integrated into lead workflow with dedicated messages list</done>
</task>

<task type="auto">
  <name>Task 3: Create AnalyticsDashboard component and page</name>
  <files>src/components/features/analytics/analyticsDashboard.tsx, src/app/business/dashboard/analytics/page.tsx</files>
  <action>Create AnalyticsDashboard with mock metrics:

Key Metrics Cards (top row):
- Total Views (this month): 1,234 (+12% vs last month)
- Total Claims: 45 (+8%)
- Conversion Rate: 3.6%
- Revenue Potential: $12,450 (sum of claimed deal prices)

Performance Section:
- Deal Performance table: Deal title, Views, Claims, Conversion %, Status
- Top performing deal highlight

Trends Section (simplified - no actual charts):
- "Views trending up 12% this month"
- "Botox deals receive 40% of all claims"
- "Peak activity: Weekday afternoons"

Use glassmorphic cards, grid layout. All data is mock/hardcoded for UI demonstration. Include info tooltips explaining metrics.</action>
  <verify>npm run build passes, analytics page displays all metric sections</verify>
  <done>Analytics dashboard shows comprehensive mock performance data</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] MessageThread renders and accepts new messages
- [ ] Lead detail includes messaging (when status allows)
- [ ] /business/dashboard/messages lists conversations
- [ ] /business/dashboard/analytics shows all metric sections
- [ ] All navigation links work
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Messaging flow works end-to-end
- Analytics displays professional mock metrics
</success_criteria>

<output>
After completion, create `.planning/phases/07-business-dashboard/07-04-SUMMARY.md`
</output>
