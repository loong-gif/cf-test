---
phase: 12-shared-components
plan: 02
type: execute
---

<objective>
Migrate all three dashboard modules (consumer, business, admin) to use the shared BaseSidebar and AuthenticatedDashboardLayout components.

Purpose: Complete the refactoring by replacing duplicated code with shared component compositions, reducing maintenance burden and ensuring consistency.
Output: All 3 dashboards using shared components, verified working correctly.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Shared components created in 12-01
@src/components/layout/baseSidebar.tsx
@src/components/layout/authenticatedDashboardLayout.tsx

# Files to migrate
@src/components/layout/dashboardSidebar.tsx
@src/components/layout/businessDashboardSidebar.tsx
@src/components/layout/adminDashboardSidebar.tsx
@src/app/dashboard/layout.tsx
@src/app/business/dashboard/layout.tsx
@src/app/admin/dashboard/layout.tsx

**Tech stack available:** Next.js 16, React, TypeScript, Tailwind CSS v4, Phosphor Icons
**Established patterns:** BaseSidebar composition, AuthenticatedDashboardLayout composition
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate consumer dashboard</name>
  <files>src/components/layout/dashboardSidebar.tsx, src/app/dashboard/layout.tsx</files>
  <action>
**dashboardSidebar.tsx:**
- Keep navItems array definition (Sparkle, Heart, ClipboardText, Gear icons)
- Import BaseSidebar and NavItem from './baseSidebar'
- Import useAuth from '@/lib/context/authContext'
- Replace entire component body with BaseSidebar composition:
  ```typescript
  export function DashboardSidebar() {
    const { state, signOut } = useAuth()
    const user = state.user

    return (
      <BaseSidebar
        navItems={navItems}
        baseRoute="/dashboard"
        user={user ? {
          displayName: user.firstName || user.email || 'User',
          initial: user.firstName?.[0]?.toUpperCase() || user.email?.[0]?.toUpperCase() || 'U'
        } : null}
        onSignOut={signOut}
      />
    )
  }
  ```
- Remove all other imports (Link, usePathname, Tooltip, SignOut icon)
- Keep NavItem interface import from baseSidebar (remove local definition)

**dashboard/layout.tsx:**
- Import AuthenticatedDashboardLayout from '@/components/layout/authenticatedDashboardLayout'
- Keep useAuth import and DashboardSidebar import
- Replace component body to use AuthenticatedDashboardLayout:
  ```typescript
  export default function DashboardLayout({ children }: { children: React.ReactNode }) {
    const { state } = useAuth()

    return (
      <AuthenticatedDashboardLayout
        sidebar={<DashboardSidebar />}
        isLoading={state.isLoading}
        isAuthenticated={state.isAuthenticated}
        redirectPath="/"
      >
        {children}
      </AuthenticatedDashboardLayout>
    )
  }
  ```
- Remove useEffect, useRouter imports
- Remove loading spinner JSX
- Remove auth check logic
  </action>
  <verify>`npm run build` passes, no TypeScript errors</verify>
  <done>Consumer dashboard sidebar and layout use shared components, exports unchanged</done>
</task>

<task type="auto">
  <name>Task 2: Migrate business dashboard</name>
  <files>src/components/layout/businessDashboardSidebar.tsx, src/app/business/dashboard/layout.tsx</files>
  <action>
**businessDashboardSidebar.tsx:**
- Keep navItems array definition (House, Tag, Users, ChatCircle, ChartLine, Buildings, Gear icons)
- Import BaseSidebar and NavItem from './baseSidebar'
- Import useBusinessAuth from '@/lib/context/businessAuthContext'
- Replace component body with BaseSidebar composition:
  ```typescript
  export function BusinessDashboardSidebar() {
    const { state, signOut } = useBusinessAuth()
    const owner = state.owner

    return (
      <BaseSidebar
        navItems={navItems}
        baseRoute="/business/dashboard"
        user={owner ? {
          displayName: owner.firstName || owner.email || 'Business Owner',
          initial: owner.firstName?.[0]?.toUpperCase() || owner.email?.[0]?.toUpperCase() || 'B'
        } : null}
        onSignOut={signOut}
      />
    )
  }
  ```
- Remove Link, usePathname, Tooltip, SignOut imports

**business/dashboard/layout.tsx:**
- Import AuthenticatedDashboardLayout from '@/components/layout/authenticatedDashboardLayout'
- Keep useBusinessAuth import and BusinessDashboardSidebar import
- **IMPORTANT:** Business layout has extra validation (businessId check) - preserve this:
  ```typescript
  export default function BusinessDashboardLayout({ children }: { children: React.ReactNode }) {
    const router = useRouter()
    const { state } = useBusinessAuth()

    // Business-specific: redirect if no businessId linked
    useEffect(() => {
      if (!state.isLoading && state.isAuthenticated && !state.owner?.businessId) {
        router.push('/business')
      }
    }, [state.isLoading, state.isAuthenticated, state.owner?.businessId, router])

    // Don't render if authenticated but no business linked
    const effectivelyAuthenticated = state.isAuthenticated && !!state.owner?.businessId

    return (
      <AuthenticatedDashboardLayout
        sidebar={<BusinessDashboardSidebar />}
        isLoading={state.isLoading}
        isAuthenticated={effectivelyAuthenticated}
        redirectPath="/business"
      >
        {children}
      </AuthenticatedDashboardLayout>
    )
  }
  ```
- Keep useEffect, useRouter imports (needed for businessId check)
- Remove loading spinner JSX (handled by AuthenticatedDashboardLayout)
  </action>
  <verify>`npm run build` passes, no TypeScript errors</verify>
  <done>Business dashboard sidebar and layout use shared components, businessId validation preserved</done>
</task>

<task type="auto">
  <name>Task 3: Migrate admin dashboard</name>
  <files>src/components/layout/adminDashboardSidebar.tsx, src/app/admin/dashboard/layout.tsx</files>
  <action>
**adminDashboardSidebar.tsx:**
- Keep navItems array definition (House, Tag, Users, Buildings, FolderSimple, ChartBar, CurrencyDollar, Database, Gear icons)
- Import BaseSidebar and NavItem from './baseSidebar'
- Import useAdminAuth from '@/lib/context/adminAuthContext'
- Replace component body with BaseSidebar composition:
  ```typescript
  export function AdminDashboardSidebar() {
    const { state, signOut } = useAdminAuth()
    const admin = state.admin

    return (
      <BaseSidebar
        navItems={navItems}
        baseRoute="/admin/dashboard"
        user={admin ? {
          displayName: admin.firstName ? `${admin.firstName} ${admin.lastName}` : admin.email || 'Admin',
          initial: admin.firstName?.[0]?.toUpperCase() || admin.email?.[0]?.toUpperCase() || 'A'
        } : null}
        onSignOut={signOut}
      />
    )
  }
  ```
- Remove Link, usePathname, Tooltip, SignOut imports

**admin/dashboard/layout.tsx:**
- Keep AdminAuthProvider wrapper (admin needs context at layout level)
- Import AuthenticatedDashboardLayout from '@/components/layout/authenticatedDashboardLayout'
- Refactor AdminDashboardContent to use AuthenticatedDashboardLayout:
  ```typescript
  function AdminDashboardContent({ children }: { children: React.ReactNode }) {
    const { state } = useAdminAuth()

    return (
      <AuthenticatedDashboardLayout
        sidebar={<AdminDashboardSidebar />}
        isLoading={state.isLoading}
        isAuthenticated={state.isAuthenticated}
        redirectPath="/admin"
      >
        {children}
      </AuthenticatedDashboardLayout>
    )
  }

  export default function AdminDashboardLayout({ children }: { children: React.ReactNode }) {
    return (
      <AdminAuthProvider>
        <AdminDashboardContent>{children}</AdminDashboardContent>
      </AdminAuthProvider>
    )
  }
  ```
- Remove useEffect, useRouter imports from AdminDashboardContent
- Remove loading spinner JSX
  </action>
  <verify>`npm run build` passes, no TypeScript errors</verify>
  <done>Admin dashboard sidebar and layout use shared components, AdminAuthProvider wrapper preserved</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Migrated all 3 dashboards (consumer, business, admin) to use shared BaseSidebar and AuthenticatedDashboardLayout components</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Test Consumer Dashboard:
       - Visit: http://localhost:3000/dashboard
       - Verify: Sidebar appears with 4 items (My Deals, Favorites, Claims, Settings)
       - Verify: Active item highlights correctly
       - Verify: Mobile bottom nav works (resize to mobile width)
       - Verify: Avatar shows user initial
       - Verify: Sign out button works
    3. Test Business Dashboard:
       - Visit: http://localhost:3000/business/dashboard
       - Verify: Sidebar appears with 7 items (Home, Deals, Leads, Messages, Analytics, Profile, Settings)
       - Verify: Active item highlights correctly
       - Verify: Mobile bottom nav shows first 5 items
       - Verify: Avatar shows owner initial
    4. Test Admin Dashboard:
       - Visit: http://localhost:3000/admin/dashboard
       - Verify: Sidebar appears with 9 items (Home, Deals, Users, Businesses, Content, Reports, Monetization, Data, Settings)
       - Verify: Active item highlights correctly
       - Verify: Mobile bottom nav shows first 5 items
       - Verify: Avatar shows admin initial
    5. Confirm: No visual changes from before migration
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] All 3 dashboards render correctly
- [ ] Navigation works on all dashboards
- [ ] Mobile bottom nav works on all dashboards
- [ ] Sign out works on all dashboards
- [ ] No visual regressions
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Phase 12 complete
</success_criteria>

<output>
After completion, create `.planning/phases/12-shared-components/12-02-SUMMARY.md`
</output>
