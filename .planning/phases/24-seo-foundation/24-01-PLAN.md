---
phase: 24-seo-foundation
plan: 01
type: execute
---

<objective>
Install SEO dependencies and establish root metadata foundation for the entire application.

Purpose: Set up the base SEO infrastructure that all location pages will inherit from, ensuring proper metadataBase, title templates, and search engine directives.
Output: next-seo and schema-dts installed, enhanced root layout metadata, environment-aware robots.ts
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/24-seo-foundation/24-RESEARCH.md

**Current state:**
- Root layout has basic metadata (title, description only)
- No robots.ts or sitemap.ts exists
- No SEO dependencies installed

**From research (24-RESEARCH.md):**
- Use metadataBase for relative URL resolution
- Title template pattern: `%s | CostFinders`
- robots.ts should block crawlers in non-production
- Block /api/, /admin/, /dashboard/ from indexing

@src/app/layout.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install SEO dependencies</name>
  <files>package.json, package-lock.json</files>
  <action>
    Run `npm install next-seo schema-dts` to add SEO libraries.
    - next-seo: Provides JSON-LD components (LocalBusinessJsonLd, etc.)
    - schema-dts: TypeScript types for Schema.org vocabulary (Google-maintained)
    Do NOT install next-sitemap yet â€” native sitemap.ts is sufficient for our ~50 location pages.
  </action>
  <verify>npm ls next-seo schema-dts shows both installed</verify>
  <done>Both packages in dependencies, no install errors</done>
</task>

<task type="auto">
  <name>Task 2: Enhance root layout metadata</name>
  <files>src/app/layout.tsx</files>
  <action>
    Update the Metadata export to include:
    1. metadataBase: new URL(process.env.NEXT_PUBLIC_BASE_URL || 'https://costfinders.com')
    2. title object with default and template: { default: 'CostFinders - Compare MedSpa Prices', template: '%s | CostFinders' }
    3. Enhanced description: 'Find and compare the best medspa deals near you. Save 20-70% on Botox, fillers, facials, and laser treatments.'
    4. openGraph defaults: { type: 'website', locale: 'en_US', siteName: 'CostFinders' }
    5. robots: { index: true, follow: true }
    6. Add applicationName, generator, keywords for additional SEO signals

    Keep existing AuthProvider/BusinessAuthProvider/etc structure unchanged.
    Import Metadata type from 'next' (already imported).
  </action>
  <verify>Run `npm run build` and check no TypeScript errors. Inspect built layout for metadata</verify>
  <done>Root layout exports comprehensive Metadata object with metadataBase, title template, openGraph, robots</done>
</task>

<task type="auto">
  <name>Task 3: Create robots.ts with environment awareness</name>
  <files>src/app/robots.ts</files>
  <action>
    Create new file src/app/robots.ts:
    1. Import MetadataRoute from 'next'
    2. Export default function robots(): MetadataRoute.Robots
    3. Get baseUrl from process.env.NEXT_PUBLIC_BASE_URL || 'https://costfinders.com'
    4. Check isProduction = process.env.VERCEL_ENV === 'production' || process.env.NODE_ENV === 'production'
    5. Production rules: allow '/', disallow ['/api/', '/admin/', '/dashboard/', '/business/dashboard/']
    6. Non-production rules: disallow everything (block crawlers on preview/staging)
    7. Always include sitemap reference: `${baseUrl}/sitemap.xml`

    Pattern from research: Environment-aware so preview deployments don't get indexed.
  </action>
  <verify>Run `npm run dev`, visit http://localhost:3000/robots.txt and verify correct output</verify>
  <done>robots.ts returns proper Disallow rules, sitemap reference present</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm ls next-seo schema-dts` shows both packages
- [ ] http://localhost:3000/robots.txt returns valid robots.txt content
- [ ] Root metadata includes metadataBase, title template, openGraph
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- SEO foundation ready for sitemap and structured data work
</success_criteria>

<output>
After completion, create `.planning/phases/24-seo-foundation/24-01-SUMMARY.md`
</output>
